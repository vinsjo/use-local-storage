{"version":3,"file":"index.js","sources":["../index.ts"],"sourcesContent":["import { decode, encode } from 'safe-json-decode';\nimport { useState, useEffect } from 'react';\nimport { Dispatch } from 'react';\n\n/**\n * Get stored value in localStorage\n *\n * @param key  local storage key\n * @param throwOnError  optional boolean indicating if errors should be thrown when error is caught, default is false\n * @returns  null on failure or if item doesn't exist, decoded JSON if stored value is valid JSON, otherwise the value stored as is\n */\nconst getStoredItem = (key: string, throwOnError: boolean = false): any => {\n\ttry {\n\t\tconst value = localStorage.getItem(key);\n\t\tif (value === null) return null;\n\t\treturn decode(value) || value;\n\t} catch (e) {\n\t\tif (throwOnError) throw e;\n\t\treturn null;\n\t}\n};\n\n/**\n * Store value in localStorage\n *\n * @param key  local storage key\n * @param data  the data to store, encoded to json if it is an object or array\n * @param throwOnError  optional boolean indicating if errors should be thrown when error is caught, default is false\n * @returns  true on success, false on failure\n */\nconst setStoredItem = (\n\tkey: string,\n\tdata: any,\n\tthrowOnError: boolean = false\n): boolean => {\n\ttry {\n\t\tconst value =\n\t\t\tdata instanceof Object || Array.isArray(data) ? encode(data) : data;\n\t\tlocalStorage.setItem(key, value);\n\t\treturn true;\n\t} catch (e) {\n\t\tif (throwOnError) throw e;\n\t\treturn false;\n\t}\n};\n/**\n * remove item from localStorage\n *\n * @param key  local storage key\n * @param throwOnError  optional boolean indicating if errors should be thrown when error is caught, default is false\n * @returns  true on success, false on failure\n */\nconst removeStoredItem = (\n\tkey: string,\n\tthrowOnError: boolean = false\n): boolean => {\n\ttry {\n\t\tlocalStorage.removeItem(key);\n\t\treturn true;\n\t} catch (e) {\n\t\tif (throwOnError) throw e;\n\t\treturn false;\n\t}\n};\n\n/**\n * synchronize state with localStorage\n *\n * @param storageKey  key to item in localStorage\n * @param initialState  optional parameter with initial state or function returning initial state. only stored in localStorage if nothing is already stored with the provided key or overwrite is set to true, default is null\n * @param overwrite  optional parameter indicates if initialState should overwrite already stored value, default is false\n */\nconst useLocalStorage = (\n\tstorageKey: string,\n\tinitialState: any | (() => any) = null,\n\toverwrite: boolean = false\n): [any, Dispatch<any>] => {\n\tconst [didMount, setDidMount] = useState(false);\n\n\tconst [key, setKey] = useState(storageKey);\n\n\tconst [state, setState] = useState(() => {\n\t\tconst initialValue =\n\t\t\ttypeof initialState === 'function' ? initialState() : initialState;\n\t\tconst stored = getStoredItem(key);\n\t\treturn overwrite || (!stored && initialState !== stored)\n\t\t\t? initialValue\n\t\t\t: stored;\n\t});\n\n\tuseEffect(() => {\n\t\tif (!didMount || storageKey === key) return;\n\t\tremoveStoredItem(key);\n\t\tsetKey(storageKey);\n\t}, [didMount, storageKey, key, setKey]);\n\n\tuseEffect(() => {\n\t\tsetStoredItem(key, state);\n\t}, [state, key]);\n\n\tuseEffect(() => {\n\t\tsetDidMount(true);\n\t}, []);\n\n\treturn [state, setState];\n};\n\nexport { getStoredItem, setStoredItem, removeStoredItem };\nexport default useLocalStorage;\n"],"names":["getStoredItem","key","throwOnError","value","localStorage","getItem","decode","e","data","Object","Array","isArray","encode","setItem","removeStoredItem","removeItem","useLocalStorage","storageKey","initialState","overwrite","didMount","setDidMount","useState","setKey","state","setState","initialValue","stored","useEffect","setStoredItem"],"mappings":"sGAWMA,MAAaA,EAAG,CAACC,EAAaC,GAAwB,KAC3D,IACC,MAAWC,EAAGC,aAAaC,QAAQJ,GACnC,OAAc,OAAVE,OACSG,EAACH,IAAUA,CAIxB,CAHC,MAAOI,GACR,GAAIL,EAAc,MAAMK,EACxB,WACA,KAWoB,CACrBN,EACAO,EACAN,GAAwB,KAExB,IACC,MAAMC,EACLK,aAAAC,QAA0BC,MAAMC,QAAQH,GAAQI,EAAOJ,GAAQA,EAEhE,OADAJ,aAAaS,QAAQZ,EAAKE,IACnB,CAIP,CAHC,MAAOI,GACR,GAAIL,EAAc,MAAAK,EAClB,OAAO,CACP,GASIO,EAAmB,CACxBb,EACAC,GAAwB,KAExB,IAEC,OADAE,aAAaW,WAAWd,IACjB,CAIP,CAHC,MAAOM,GACR,GAAIL,EAAc,MAAMK,EACxB,OAAO,CACP,GAUIS,EAAkB,CACvBC,EACAC,EAAkC,KAClCC,GAAqB,KAErB,MAAOC,EAAUC,GAAeC,GAAS,IAElCrB,EAAKsB,GAAUD,EAASL,IAExBO,EAAOC,GAAYH,EAAS,KAClC,MAAMI,EACmB,mBAAjBR,EAA8BA,IAAiBA,EAC3CS,EAAG3B,EAAcC,GAC7B,OAAOkB,IAAeQ,GAAUT,IAAiBS,EAC9CD,EACAC,IAiBJ,OAdAC,EAAU,KACJR,GAAYH,IAAehB,IAChCa,EAAiBb,GACjBsB,EAAON,KACL,CAACG,EAAUH,EAAYhB,EAAKsB,IAE/BK,EAAU,KACTC,EAAc5B,EAAKuB,EACnB,EAAE,CAACA,EAAOvB,IAEX2B,EAAU,KACTP,GAAY,IACV,IAEI,CAACG,EAAOC,EAAR"}